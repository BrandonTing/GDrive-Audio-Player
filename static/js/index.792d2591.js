(()=>{"use strict";var e={256:function(e,t,r){var a=r(893),l=r(294),n=r(745),o=r(997),s=r(303),i=r(942);let c=()=>(0,a.jsx)("div",{className:"fixed top-4 left-1/2 -translate-x-1/2 z-50",children:(0,a.jsxs)("div",{className:"flex items-center px-4 py-2 bg-gray-800 rounded-full shadow-lg",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),(0,a.jsx)("span",{className:"ml-3 text-white text-sm",children:"Loading..."})]})}),d=(0,l.createContext)(void 0),u=e=>{let{children:t}=e,r=(0,o.s0)(),n=(0,l.useMemo)(()=>({onLoginSuccess:()=>{r("/")}}),[r]);return(0,a.jsx)(d.Provider,{value:n,children:t})};var m=r(428),x=r(124),g=r(266);let p=e=>{let t=[...e];for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t},h=(0,x.cY)({types:{context:{},events:{}}}).createMachine({id:"playlist",initial:"active",context:()=>{try{let e=localStorage.getItem("audioPlayerPlaylist");if(e){let t=JSON.parse(e);return{tracks:t.tracks||[],shuffledTracks:t.shuffledTracks||[],currentTrackIndex:void 0!==t.currentTrackIndex?t.currentTrackIndex:null,shuffle:t.shuffle||!1,repeat:t.repeat||"none"}}}catch(e){console.error("Failed to load playlist from localStorage:",e)}return{tracks:[],shuffledTracks:[],currentTrackIndex:null,shuffle:!1,repeat:"none"}},states:{active:{on:{ADD_TRACK:{actions:(0,g.a)(e=>{let{context:t,event:r}=e;if(!t.tracks.some(e=>e.id===r.track.id)){let e=[...t.tracks,r.track];return t.shuffle,{...t,tracks:e,shuffledTracks:p(e)}}return t})},REMOVE_TRACK:{actions:(0,g.a)({tracks:e=>{let{context:t,event:r}=e;return t.tracks.filter(e=>e.id!==r.trackId)},shuffledTracks:e=>{let{context:t,event:r}=e;return t.shuffledTracks.filter(e=>e.id!==r.trackId)},currentTrackIndex:e=>{var t;let{context:r,event:a}=e;return null!==r.currentTrackIndex&&(null==(t=r.tracks[r.currentTrackIndex])?void 0:t.id)===a.trackId?null:r.currentTrackIndex}})},PLAY_TRACK:{actions:(0,g.a)({currentTrackIndex:e=>{let{context:t,event:r}=e,a=t.shuffle?t.shuffledTracks:t.tracks,l=a.findIndex(e=>e.id===r.trackId);return -1!==l&&i.ZP.success(`Now Playing: ${a[l].name}`),-1!==l?l:null}})},PLAY_NEXT:{actions:(0,g.a)({currentTrackIndex:e=>{let{context:t}=e;if("one"===t.repeat)return t.currentTrackIndex;let r=t.shuffle?t.shuffledTracks:t.tracks;if(null===t.currentTrackIndex)return 0;let a=t.currentTrackIndex+1;return a>=r.length?"all"===t.repeat?(i.ZP.success(`Now Playing: ${r[0].name}`),0):null:(i.ZP.success(`Now Playing: ${r[a].name}`),a)}})},PLAY_PREVIOUS:{actions:(0,g.a)({currentTrackIndex:e=>{let{context:t}=e,r=t.shuffle?t.shuffledTracks:t.tracks;if(null===t.currentTrackIndex)return 0;let a=t.currentTrackIndex-1,l=a<0?r.length-1:a;return i.ZP.success(`Now Playing: ${r[l].name}`),l}})},CLEAR_PLAYLIST:{actions:(0,g.a)({tracks:[],shuffledTracks:[],currentTrackIndex:null})},TOGGLE_SHUFFLE:{actions:(0,g.a)({shuffle:e=>{let{context:t}=e;return!t.shuffle},shuffledTracks:e=>{let{context:t}=e;return t.shuffle?[]:p(t.tracks)}})},TOGGLE_REPEAT:{actions:(0,g.a)({repeat:e=>{let{context:t}=e;return"none"===t.repeat?"all":"all"===t.repeat?"one":"none"}})}}}}}),f=(0,l.createContext)(void 0),y=e=>{let{children:t}=e,[r,l]=(0,m.eO)(h);return(0,a.jsx)(f.Provider,{value:{playlistState:r,sendToPlaylist:l},children:t})},b=()=>{let e=(0,l.useContext)(f);if(void 0===e)throw Error("usePlaylist must be used within a PlaylistProvider");return e},v=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],j=!1;async function k(){if(localStorage.getItem("google_access_token"))throw(0,o.uX)("/");return null}async function T(){if(!localStorage.getItem("google_access_token"))throw(0,o.uX)("/login");return null}var N=r(368);let w=r(430).Z.create({baseURL:"https://www.googleapis.com/drive/v3"});w.interceptors.request.use(e=>{let t=localStorage.getItem("google_access_token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e));let E=async e=>{try{let t=e?`'${e}' in parents`:"'root' in parents";return(await w.get("/files",{params:{q:`${t} and trashed = false and (mimeType = 'application/vnd.google-apps.folder' or mimeType contains 'audio/')`,fields:"files(id, name, mimeType)"}})).data.files}catch(t){throw console.error(`Error fetching contents for folder ${e||"root"}:`,t),t}},I=async e=>{try{let t=await w.get(`/files/${e}`,{params:{alt:"media"},responseType:"arraybuffer"}),r=t.headers["content-type"],a=new Blob([t.data],{type:r});return URL.createObjectURL(a)}catch(e){throw console.error("Error fetching audio file as blob:",e),e}},P=(0,x.C8)({id:"audioPlayer",context:{blobUrl:null,error:null,fileId:null,audioRef:null,volume:1,duration:0,currentTime:0},initial:"idle",states:{idle:{},loading:{invoke:{id:"loadAudio",src:(0,N.p4)(e=>{let{input:t}=e;return I(t.fileId)}),onDone:{target:"loadingAudio",actions:(0,g.a)({blobUrl:e=>{let{event:t}=e;return t.output}})},onError:{target:"error",actions:(0,g.a)({error:e=>{let{event:t}=e;return t.error.message}})},input:e=>{let{context:t}=e;return{fileId:t.fileId}}}},loadingAudio:{on:{LOAD_AUDIO:{target:"playing"}}},playing:{entry:"playAudio",on:{PAUSE:"paused",ENDED:"idle",ERROR:{target:"error",actions:(0,g.a)({error:e=>{let{event:t}=e;return t.message}})},SET_VOLUME:{actions:"setVolume"},UPDATE_TIME:{actions:"updateTime"},SEEK:{actions:"seek"}}},paused:{entry:"pauseAudio",on:{PLAY:"playing",LOAD:{target:"loading",actions:(0,g.a)({fileId:e=>{let{event:t}=e;return t.fileId},error:null,blobUrl:null})}}},error:{on:{LOAD:{target:"loading",actions:(0,g.a)({fileId:e=>{let{event:t}=e;return t.fileId},error:null,blobUrl:null})}}}},on:{LOAD:{target:".loading",actions:(0,g.a)({fileId:e=>{let{event:t}=e;return t.fileId},error:null,blobUrl:null})},SET_REF:{actions:(0,g.a)({audioRef:e=>{let{event:t}=e;return t.audioRef}})},UPDATE_DURATION:{actions:(0,g.a)({duration:e=>{let{event:t}=e;return t.duration}})}}},{actions:{playAudio:e=>{let{context:t}=e,r=t.audioRef;r&&(r.src!==t.blobUrl&&(r.src=t.blobUrl||"",r.load()),r.volume=t.volume,r.play().catch(e=>console.error("Error playing audio:",e)))},pauseAudio:e=>{let{context:t}=e,r=t.audioRef;r&&r.pause()},setVolume:(0,g.a)({volume:e=>{let{event:t,context:r}=e;return"SET_VOLUME"===t.type?(r.audioRef&&(r.audioRef.volume=t.volume),t.volume):r.volume}}),updateTime:(0,g.a)({currentTime:e=>{let{event:t}=e;return"UPDATE_TIME"===t.type?t.time:0}}),seek:e=>{let{context:t,event:r}=e;"SEEK"===r.type&&t.audioRef&&(t.audioRef.currentTime=r.time)}}}),A=(0,m.jS)(P),_=A.Provider,R=A.useActorRef,C=A.useSelector,S=e=>{let t=Math.floor(e/60),r=Math.floor(e%60);return`${t}:${r<10?"0":""}${r}`},L=()=>{let e=(0,l.useId)(),t=(0,l.useId)(),r=(0,l.useId)(),n=R(),o=C(e=>e),s=n.send,{playlistState:i,sendToPlaylist:c}=b(),d=null!==i.context.currentTrackIndex&&i.context.tracks[i.context.currentTrackIndex]?i.context.tracks[i.context.currentTrackIndex].id:null,u=(0,l.useCallback)(e=>{e&&s({type:"SET_REF",audioRef:e})},[s]);return(0,l.useEffect)(()=>{d&&d!==o.context.fileId&&s({type:"LOAD",fileId:d})},[d,o.context.fileId,s]),(0,a.jsxs)("div",{className:"flex flex-col items-center p-4 text-white bg-gray-900",children:[(0,a.jsx)("audio",{id:e,ref:u,src:o.context.blobUrl||void 0,preload:"auto",onEnded:()=>s({type:"ENDED"}),onError:()=>s({type:"ERROR",message:"Failed to play"}),onTimeUpdate:()=>{var e;return s({type:"UPDATE_TIME",time:null==(e=o.context.audioRef)?void 0:e.currentTime})},onLoadedData:()=>s({type:"LOAD_AUDIO"}),onLoadedMetadata:()=>{var e;return s({type:"UPDATE_DURATION",duration:null==(e=o.context.audioRef)?void 0:e.duration})},autoPlay:!0,children:(0,a.jsx)("track",{kind:"captions"})}),null!==i.context.currentTrackIndex&&i.context.tracks[i.context.currentTrackIndex]&&(0,a.jsxs)("p",{className:"mb-2 text-lg font-semibold",children:["Now Playing:"," ",i.context.tracks[i.context.currentTrackIndex].name]}),(0,a.jsxs)("p",{className:"mb-2 text-sm",children:["Status: ",String(o.value)]}),o.matches("error")&&(0,a.jsxs)("p",{className:"mb-2 text-sm text-red-500",children:["Error: ",o.context.error]}),(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-4 w-full max-w-lg",children:[(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("label",{htmlFor:"seek-bar",className:"block text-sm font-medium text-gray-300",children:"Seek:"}),(0,a.jsx)("input",{id:t,type:"range",min:"0",max:o.context.duration,step:"0.01",value:o.context.currentTime,onChange:e=>{s({type:"SEEK",time:parseFloat(e.target.value)})},className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"}),(0,a.jsxs)("div",{className:"flex justify-between text-xs text-gray-400",children:[(0,a.jsx)("span",{children:S(o.context.currentTime)}),(0,a.jsx)("span",{children:S(o.context.duration)})]})]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>c({type:"PLAY_PREVIOUS"}),className:"px-4 py-2 bg-gray-700 rounded-md hover:bg-gray-600",children:"Previous"}),o.matches("playing")&&(0,a.jsx)("button",{type:"button",onClick:()=>s({type:"PAUSE"}),className:"px-4 py-2 bg-gray-700 rounded-md hover:bg-gray-600",children:"Pause"}),(o.matches("idle")||o.matches("error")||o.matches("paused")&&o.context.blobUrl)&&(0,a.jsx)("button",{type:"button",onClick:()=>s({type:"PLAY"}),className:"px-4 py-2 bg-gray-700 rounded-md hover:bg-gray-600",children:"Play"}),(0,a.jsx)("button",{type:"button",onClick:()=>c({type:"PLAY_NEXT"}),className:"px-4 py-2 bg-gray-700 rounded-md hover:bg-gray-600",children:"Next"}),(0,a.jsx)("button",{type:"button",onClick:()=>c({type:"TOGGLE_SHUFFLE"}),className:"px-4 py-2 bg-gray-700 rounded-md hover:bg-gray-600",children:"Shuffle"}),(0,a.jsxs)("button",{type:"button",onClick:()=>c({type:"TOGGLE_REPEAT"}),className:"px-4 py-2 bg-gray-700 rounded-md hover:bg-gray-600",children:["Repeat: ",i.context.repeat]})]}),(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsxs)("label",{htmlFor:"volume-control",className:"block text-sm font-medium text-gray-300",children:["Volume: ",Math.round(100*o.context.volume),"%"]}),(0,a.jsx)("input",{id:r,type:"range",min:"0",max:"1",step:"0.01",value:o.context.volume,onChange:e=>{s({type:"SET_VOLUME",volume:parseFloat(e.target.value)})},className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"})]}),o.matches("loading")&&(0,a.jsx)("p",{className:"text-yellow-500",children:"Loading..."})]})]})},O=()=>{let{playlistState:e,sendToPlaylist:t}=b(),r=R(),l=r.getSnapshot(),n=r.send,{tracks:o,currentTrackIndex:s}=e.context;return(0,a.jsxs)("div",{className:"p-4 text-white bg-gray-800 rounded-lg shadow-lg",children:[(0,a.jsx)("h2",{className:"mb-4 text-2xl font-bold",children:"Playlist"}),0===o.length?(0,a.jsx)("p",{className:"text-gray-400",children:"Playlist is empty."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("ul",{className:"mb-4 space-y-2",children:o.map((e,r)=>(0,a.jsxs)("li",{className:`flex items-center justify-between p-2 rounded-md ${r===s?"bg-gray-600 font-bold":"bg-gray-800"}`,children:[(0,a.jsx)("span",{className:"mr-2 truncate",children:e.name}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{t({type:"PLAY_TRACK",trackId:e.id})},className:"px-3 py-1 text-sm bg-gray-700 rounded-md hover:bg-gray-600",children:"Play"}),(0,a.jsx)("button",{type:"button",onClick:()=>{t({type:"REMOVE_TRACK",trackId:e.id})},className:"px-3 py-1 text-sm bg-gray-700 rounded-md hover:bg-gray-600",children:"Remove"})]})]},e.id))}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 justify-center",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{t({type:"CLEAR_PLAYLIST"})},className:"px-4 py-2 bg-gray-700 rounded-md hover:bg-gray-600",children:"Clear Playlist"}),null!==s&&(0,a.jsx)("button",{type:"button",onClick:()=>{l.matches("playing")?n({type:"PAUSE"}):n({type:"PLAY"})},className:"px-4 py-2 bg-gray-700 rounded-md hover:bg-gray-600",children:l.matches("playing")?"Pause Current":"Play Current"})]})]})]})},D=()=>{let{files:e}=(0,o.f_)(),{folderId:t}=(0,o.UO)(),r=(0,o.s0)(),{sendToPlaylist:l}=b(),n=e.filter(e=>"application/vnd.google-apps.folder"===e.mimeType),s=e.filter(e=>e.mimeType.startsWith("audio/"));return(0,a.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,a.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex-1 p-5 overflow-y-auto",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-4",children:t?"Folder Contents":"Your Google Drive Files"}),t&&(0,a.jsx)("button",{type:"button",onClick:()=>{t&&r("/")},className:"mb-4 px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md text-white",children:"Back to Parent Folder"}),(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-3",children:"Folders"}),0===n.length?(0,a.jsx)("p",{className:"text-gray-400",children:"No subfolders found."}):(0,a.jsx)("ul",{className:"space-y-2",children:n.map(e=>(0,a.jsx)("li",{children:(0,a.jsxs)("button",{type:"button",onClick:()=>{r(`/folder/${e.id}`)},className:"text-blue-400 hover:text-blue-300 text-lg",children:["\uD83D\uDCC1 ",e.name]})},e.id))}),(0,a.jsx)("h2",{className:"text-2xl font-semibold mt-6 mb-3",children:"Audio Files"}),0===s.length?(0,a.jsx)("p",{className:"text-gray-400",children:"No audio files found in this folder."}):(0,a.jsx)("ul",{className:"space-y-2",children:s.map(e=>(0,a.jsxs)("li",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{l({type:"ADD_TRACK",track:e}),l({type:"PLAY_TRACK",trackId:e.id})},className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded-md text-white text-sm",children:"▶️ Play"}),(0,a.jsx)("button",{type:"button",onClick:()=>{l({type:"ADD_TRACK",track:e}),i.ZP.success(`${e.name} added to playlist!`)},className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded-md text-white text-sm",children:"➕ Add to Playlist"}),(0,a.jsx)("span",{className:"text-lg",children:e.name}),(0,a.jsxs)("span",{className:"text-gray-500 text-sm",children:["(",e.mimeType,")"]})]},e.id))})]}),(0,a.jsx)("div",{className:"w-80 p-5 border-l border-gray-700 overflow-y-auto bg-gray-800",children:(0,a.jsx)(_,{children:(0,a.jsx)(O,{})})})]}),(0,a.jsx)("div",{className:"border-t border-gray-700 bg-gray-900 p-4",children:(0,a.jsx)(_,{children:(0,a.jsx)(L,{})})})]})};async function U(e){let{params:t}=e,r=t.folderId;try{return{files:await E(r||null)}}catch(e){return console.error("Error in HomePage loader:",e),localStorage.removeItem("google_access_token"),(0,o.uX)("/login")}}var F=r(426);let M=e=>{let{onLoginSuccess:t}=e,r=(0,F.Nq)({onSuccess:e=>{console.log("Login Success:",e),localStorage.setItem("google_access_token",e.access_token),window.dispatchEvent(new Event("storage")),t()},onError:()=>{console.log("Login Failed")},scope:"https://www.googleapis.com/auth/drive.readonly"});return(0,a.jsxs)("button",{type:"button",onClick:()=>r(),className:"flex justify-center items-center px-6 py-3 w-full font-semibold text-white bg-blue-600 rounded-lg shadow-md transition duration-300 ease-in-out hover:bg-blue-700",children:[(0,a.jsx)("img",{src:"https://www.gstatic.com/images/branding/googleg/1x/googleg_standard_color_18dp.png",alt:"Google icon",className:"mr-2 w-5 h-5"}),"Sign in with Google"]})},G=(0,o.aj)([{path:"/",element:(0,a.jsx)(()=>{(0,l.useEffect)(()=>{let e=document.createElement("script");e.src="https://apis.google.com/js/api.js",e.async=!0,e.defer=!0,e.onload=()=>{new Promise((e,t)=>{if(j)return void e();gapi.load("client:auth2",()=>{gapi.client.init({discoveryDocs:v,scope:"https://www.googleapis.com/auth/drive.readonly"}).then(()=>gapi.client.load("drive","v3")).then(()=>{j=!0,e()}).catch(e=>{console.error("Error initializing gapi client:",e),t(e)})})})},e.onerror=()=>{console.error("Failed to load gapi.js")},document.body.appendChild(e)},[]);let e=(0,o.HJ)();return(0,a.jsx)(u,{children:(0,a.jsxs)(y,{children:[" ",(0,a.jsx)(i.x7,{}),"loading"===e.state&&(0,a.jsx)(c,{}),(0,a.jsx)(o.j3,{})]})})},{}),children:[{loader:T,children:[{index:!0,element:(0,a.jsx)(D,{}),loader:U},{path:"folder/:folderId",element:(0,a.jsx)(D,{}),loader:U}]},{path:"login",element:(0,a.jsx)(()=>{let e="291740467482-q07a2e5pqioq9juuns7gub5uuin6coda.apps.googleusercontent.com",{onLoginSuccess:t}=(()=>{let e=(0,l.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e})();return e?(0,a.jsx)(F.rg,{clientId:e,children:(0,a.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-900 text-white p-4",children:(0,a.jsxs)("div",{className:"bg-gray-800 p-8 rounded-lg shadow-lg text-center max-w-md w-full",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold mb-4",children:"GDrive Audio Player"}),(0,a.jsx)("p",{className:"text-gray-300 mb-8",children:"Access and play your audio files directly from Google Drive."}),(0,a.jsx)(M,{onLoginSuccess:t})]})})}):(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-900 text-red-500",children:"Error: Missing Google Client ID. Please check your environment variables."})},{}),loader:k}]}],{basename:"/GDrive-Audio-Player"}),$=document.getElementById("root");$&&n.createRoot($).render((0,a.jsx)(l.StrictMode,{children:(0,a.jsx)(s.p,{router:G})}))}},t={};function r(a){var l=t[a];if(void 0!==l)return l.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,r),n.exports}r.m=e,r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];r.O=(t,a,l,n)=>{if(a){n=n||0;for(var o=e.length;o>0&&e[o-1][2]>n;o--)e[o]=e[o-1];e[o]=[a,l,n];return}for(var s=1/0,o=0;o<e.length;o++){for(var[a,l,n]=e[o],i=!0,c=0;c<a.length;c++)(!1&n||s>=n)&&Object.keys(r.O).every(e=>r.O[e](a[c]))?a.splice(c--,1):(i=!1,n<s&&(s=n));if(i){e.splice(o--,1);var d=l();void 0!==d&&(t=d)}}return t}})(),(()=>{var e={980:0};r.O.j=t=>0===e[t];var t=(t,a)=>{var l,n,[o,s,i]=a,c=0;if(o.some(t=>0!==e[t])){for(l in s)r.o(s,l)&&(r.m[l]=s[l]);if(i)var d=i(r)}for(t&&t(a);c<o.length;c++)n=o[c],r.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return r.O(d)},a=self.webpackChunkrsbuild_react_ts=self.webpackChunkrsbuild_react_ts||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var a=r.O(void 0,["72","361","118","113"],function(){return r(256)});a=r.O(a)})();